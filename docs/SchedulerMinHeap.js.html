<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SchedulerMinHeap.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#cancelHostTimeout">cancelHostTimeout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#compare">compare</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#isHostCallbackScheduled">isHostCallbackScheduled</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#isHostTimeoutScheduled">isHostTimeoutScheduled</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#isMessageLoopRunning">isMessageLoopRunning</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#isPerformingWork">isPerformingWork</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#NoPriority">NoPriority</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#peek">peek</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#performWorkUntilDeadline">performWorkUntilDeadline</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#pop">pop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#push">push</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#requestHostCallback">requestHostCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#requestHostTimeout">requestHostTimeout</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#scheduledHostCallback">scheduledHostCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#siftDown">siftDown</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#siftUp">siftUp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#slowTask">slowTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#unstable_getFirstCallbackNode">unstable_getFirstCallbackNode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#unstable_scheduleCallback">unstable_scheduleCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#workLoop">workLoop</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">SchedulerMinHeap.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @flow strict
 */

/**
 *  в этом файле находится реализация бинарной кучи,
 *  которая используется для приоритизированного хранения задач
 */

/**
 *  @description Пушит элемент в конец кучи, дальше с помощью siftUp куча нормализуется,
 *  так как новый элемент может иметь вес больше,чем у его parent элементов и они меняются местами
 *  @param node {{  id: number, sortIndex: number}} элемент, который нужно запушить,
 *  тут еще могут быть поля, основные id и sortIndex, по которым производится сортировка
 *  @param heap {{  id: number, sortIndex: number}[]} куча, в которую нужно сделать push
 */
export function push(heap, node) {
  const index = heap.length;
  heap.push(node);
  siftUp(heap, node, index);
}

/**
 *  @description Отдает самый верхний элемент кучи
 *  @param heap {{  id: number, sortIndex: number}[]} куча, из которой нужно достать элемент
 *  @return {{ id: number, sortIndex: number} | null} если куча не пуста,
 *  то возвращаем элемент с самым высоким приоритетом, иначе null
 */
export function peek(heap) {
  return heap.length === 0 ? null : heap[0];
}

/**
 *  @description удаляет самый последний элемент, затем меняет местами последний и первый элемент,
 *  после этого куча нормализуется с помощью siftDown
 *  @param heap {{  id: number, sortIndex: number}[]} куча, из которой нужно удалить последний элемент
 *  @return {{ id: number, sortIndex: number} | null} если куча не пуста, то возвращаем последний элемент , иначе null
 */
export function pop(heap) {
  if (heap.length === 0) {
    return null;
  }
  const first = heap[0];
  const last = heap.pop();
  if (last !== first) {
    heap[0] = last;
    siftDown(heap, last, 0);
  }
  return first;
}

/**
 *  @description нормализация кучи "на месте", просеиваиние элементов вверх
 *  @param heap {{  id: number, sortIndex: number}[]} куча, которую нужно нормализотвать, после вставки
 *  @param node {{  id: number, sortIndex: number}} элемент, который нужно вставить
 *  @param i {number} индекс, последенго вставленного элемента
 *  @return {void} Ничего не возрващает, результат функции это нормализовання куча, нормализация происходит "на месте"
 */
function siftUp(heap, node, i) {
  let index = i;
  while (index > 0) {
    const parentIndex = (index - 1) >>> 1;
    const parent = heap[parentIndex];
    if (compare(parent, node) > 0) {
      // The parent is larger. Swap positions.
      heap[parentIndex] = node;
      heap[index] = parent;
      index = parentIndex;
    } else {
      // The parent is smaller. Exit.
      return;
    }
  }
}

/**
 *  @description нормализация кучи "на месте", просеиваиние элементов вниз
 *  @param heap {{  id: number, sortIndex: number}[]} куча, которую нужно нормализотвать, после удаления
 *  @param node {{  id: number, sortIndex: number}} элемент, последний элемент
 *  @param i {number} индекс, откуда начать нормальзацию
 *  @return {void} Ничего не возрващает, результат функции это нормализовання куча, нормализация происходит "на месте"
 */
function siftDown(heap, node, i) {
  let index = i;
  const length = heap.length;
  const halfLength = length >>> 1;
  while (index &lt; halfLength) {
    const leftIndex = (index + 1) * 2 - 1;
    const left = heap[leftIndex];
    const rightIndex = leftIndex + 1;
    const right = heap[rightIndex];

    // If the left or right node is smaller, swap with the smaller of those.
    if (compare(left, node) &lt; 0) {
      if (rightIndex &lt; length &amp;&amp; compare(right, left) &lt; 0) {
        heap[index] = right;
        heap[rightIndex] = node;
        index = rightIndex;
      } else {
        heap[index] = left;
        heap[leftIndex] = node;
        index = leftIndex;
      }
    } else if (rightIndex &lt; length &amp;&amp; compare(right, node) &lt; 0) {
      heap[index] = right;
      heap[rightIndex] = node;
      index = rightIndex;
    } else {
      // Neither child is smaller. Exit.
      return;
    }
  }
}

/**
 *  @description функция сравнения двух элементов кучи
 *  @param a {{  id: number, sortIndex: number}}  левый элемент
 *  @param b {{  id: number, sortIndex: number}}  правый элемент
 *  @return {number} возварщает число, которое затем используется для сортировки
 */
function compare(a, b) {
  // Compare sort index first, then task id.
  const diff = a.sortIndex - b.sortIndex;
  return diff !== 0 ? diff : a.id - b.id;
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu Dec 16 2021 00:10:49 GMT+0300 (Москва, стандартное время) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
